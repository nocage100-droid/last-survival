<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµœí›„ì˜ìƒì¡´ ê·¼ì ‘ë¬´ê¸° ì—ë””í„°</title>
    <link rel="icon" type="image/svg+xml" href="../img/logos/suroi_favicon.svg">
    <link rel="stylesheet" href="admin.css">
    <style>
        .weapon-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            max-height: 350px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .weapon-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .weapon-item:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .weapon-item.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.3);
        }

        .weapon-item img {
            width: 100%;
            height: 60px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }

        .weapon-item .name {
            font-size: 11px;
            color: #aaa;
            margin-top: 5px;
        }

        .preview-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
        }

        .preview-box img {
            max-width: 150px;
            max-height: 80px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
        }

        .stat-sliders {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .slider-group {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 8px;
        }

        .slider-group label {
            display: flex;
            justify-content: space-between;
            color: #aaa;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .slider-group .value {
            color: #667eea;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tabs button {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #aaa;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
        }

        .tabs button.active {
            background: rgba(102, 126, 234, 0.3);
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .code-output {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 11px;
            max-height: 300px;
            overflow: auto;
            white-space: pre-wrap;
            color: #38ef7d;
        }

        .spawn-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            cursor: pointer;
            color: #aaa;
        }

        .spawn-checkbox:hover {
            background: rgba(102, 126, 234, 0.2);
        }
    </style>
</head>

<body>
    <header class="header">
        <h1><span
                style="background: linear-gradient(135deg, #ff6b00, #ff4500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900;">ìµœí›„ì˜ìƒì¡´</span>
            ê·¼ì ‘ë¬´ê¸° ì—ë””í„°</h1>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="location.href='/admin/'">â† ê´€ë¦¬ì íŒ¨ë„</button>
            <button class="btn btn-success" onclick="exportMelee()">ğŸ’¾ ë‚´ë³´ë‚´ê¸°</button>
        </div>
    </header>

    <div style="padding: 20px;">
        <div class="tabs">
            <button class="active" onclick="showTab('create')">ğŸ—¡ï¸ ê·¼ì ‘ë¬´ê¸° ìƒì„±</button>
            <button onclick="showTab('gallery')">ğŸ–¼ï¸ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬</button>
            <button onclick="showTab('export')">ğŸ“„ ì½”ë“œ ì¶œë ¥</button>
        </div>

        <div id="create" class="tab-content active">
            <div class="card">
                <h2>ê¸°ë³¸ ì •ë³´</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>ë¬´ê¸° ID (ì˜ë¬¸)</label>
                        <input type="text" id="melee-id" placeholder="my_sword" oninput="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>ë¬´ê¸° ì´ë¦„</label>
                        <input type="text" id="melee-name" placeholder="My Sword" oninput="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>í‹°ì–´</label>
                        <select id="melee-tier" onchange="updatePreview()">
                            <option value="D">D (ì¼ë°˜)</option>
                            <option value="C">C (ë¹„ì¼ë°˜)</option>
                            <option value="B">B (í¬ê·€)</option>
                            <option value="A">A (ì—í”½)</option>
                            <option value="S">S (ë ˆì „ë“œë¦¬)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ê³µê²© ëª¨ë“œ</label>
                        <select id="melee-firemode" onchange="updatePreview()">
                            <option value="Single">ë‹¨ë°œ (í´ë¦­)</option>
                            <option value="Auto">ìë™ (í™€ë“œ)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ì´ë¯¸ì§€ ì„ íƒ</h2>
                <div class="preview-box">
                    <img id="selected-preview" src="../img/game/shared/weapons/kbar.svg" alt="Preview">
                    <p id="selected-name" style="color:#aaa; font-size:12px; margin-top:10px;">kbar.svg</p>
                </div>
                <div class="weapon-gallery" id="melee-gallery"></div>
            </div>

            <div class="card">
                <h2>ìŠ¤íƒ¯ ì¡°ì •</h2>
                <div class="stat-sliders">
                    <div class="slider-group">
                        <label>í”¼í•´ëŸ‰ <span class="value" id="val-damage">25</span></label>
                        <input type="range" id="stat-damage" min="5" max="100" value="25"
                            oninput="updateStat('damage')">
                    </div>
                    <div class="slider-group">
                        <label>ê³µê²© ì¿¨ë‹¤ìš´ (ms) <span class="value" id="val-cooldown">250</span></label>
                        <input type="range" id="stat-cooldown" min="50" max="1000" value="250" step="10"
                            oninput="updateStat('cooldown')">
                    </div>
                    <div class="slider-group">
                        <label>ê³µê²© ë²”ìœ„ <span class="value" id="val-radius">2.5</span></label>
                        <input type="range" id="stat-radius" min="1" max="5" value="2.5" step="0.1"
                            oninput="updateStat('radius')">
                    </div>
                    <div class="slider-group">
                        <label>ì¥ì• ë¬¼ í”¼í•´ ë°°ìœ¨ <span class="value" id="val-obstacle">1.5</span></label>
                        <input type="range" id="stat-obstacle" min="0.5" max="5" value="1.5" step="0.1"
                            oninput="updateStat('obstacle')">
                    </div>
                    <div class="slider-group">
                        <label>ì´ë™ì†ë„ ë°°ìœ¨ <span class="value" id="val-speed">1.0</span></label>
                        <input type="range" id="stat-speed" min="0.7" max="1.3" value="1" step="0.01"
                            oninput="updateStat('speed')">
                    </div>
                    <div class="slider-group">
                        <label>ì–¼ìŒ í”¼í•´ ë°°ìœ¨ <span class="value" id="val-ice">0.01</span></label>
                        <input type="range" id="stat-ice" min="0.01" max="5" value="0.01" step="0.01"
                            oninput="updateStat('ice')">
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“ ìŠ¤í° ìœ„ì¹˜</h2>
                <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:10px;">
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-melee-crate" checked> ğŸ“¦ ê·¼ì ‘ë¬´ê¸°
                        ìƒì</label>
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-regular-crate"> ğŸ“¦ ì¼ë°˜ ìƒì</label>
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-airdrop-melee"> ğŸª‚ ì—ì–´ë“œë</label>
                </div>
                <div class="form-row" style="margin-top:15px;">
                    <div class="form-group">
                        <label>ìŠ¤í° í™•ë¥  (weight)</label>
                        <input type="number" id="spawn-weight" value="0.5" step="0.1" min="0.1" max="5">
                    </div>
                </div>
            </div>
        </div>

        <div id="gallery" class="tab-content">
            <div class="card">
                <h2>ğŸ–¼ï¸ ê·¼ì ‘ë¬´ê¸° ì´ë¯¸ì§€</h2>
                <div class="weapon-gallery" id="full-gallery" style="max-height:600px;"></div>
            </div>
        </div>

        <div id="export" class="tab-content">
            <div class="card">
                <h2>ğŸ“„ ìƒì„±ëœ TypeScript ì½”ë“œ</h2>
                <p style="color:#aaa; margin-bottom:15px;"><code>common/src/definitions/items/melees.ts</code>ì— ì¶”ê°€</p>
                <div class="code-output" id="code-output"></div>
                <div style="margin-top:15px; display:flex; gap:10px;">
                    <button class="btn btn-primary" onclick="copyCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
                    <button class="btn btn-success" onclick="downloadCode()">ğŸ’¾ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
                    <button class="btn btn-danger" onclick="saveToFile()"
                        style="background:linear-gradient(135deg,#f5576c 0%,#ff6b6b 100%);">ğŸš€ ê²Œì„ì— ì¶”ê°€</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const meleeImages = [
            "baseball_bat", "chainsaw", "crowbar", "crowbar_halloween", "crowbar_rusted",
            "falchion", "fire_hatchet", "hatchet", "ice_pick", "kbar", "kukri",
            "maul", "pan", "scythe", "seax", "sickle"
        ];

        let selectedImage = "kbar";

        function createGallery(containerId) {
            document.getElementById(containerId).innerHTML = meleeImages.map(name => `
            <div class="weapon-item ${name === selectedImage ? 'selected' : ''}" onclick="selectMelee('${name}')">
                <img src="../img/game/shared/weapons/${name}.svg" alt="${name}" onerror="this.src='../img/game/shared/weapons/kbar.svg'">
                <div class="name">${name}</div>
            </div>
        `).join('');
        }

        function selectMelee(name) {
            selectedImage = name;
            document.querySelectorAll('.weapon-item').forEach(el => el.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            document.getElementById('selected-preview').src = `../img/game/shared/weapons/${name}.svg`;
            document.getElementById('selected-name').textContent = name + '.svg';
            updatePreview();
        }

        function updateStat(stat) {
            document.getElementById(`val-${stat}`).textContent = document.getElementById(`stat-${stat}`).value;
            updatePreview();
        }

        function showTab(tabId) {
            document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            if (tabId === 'export') generateCode();
        }

        function generateCode() {
            const id = document.getElementById('melee-id').value || 'my_melee';
            const name = document.getElementById('melee-name').value || 'My Melee';
            const tier = document.getElementById('melee-tier').value;
            const fireMode = document.getElementById('melee-firemode').value;
            const damage = document.getElementById('stat-damage').value;
            const cooldown = document.getElementById('stat-cooldown').value;
            const radius = document.getElementById('stat-radius').value;
            const obstacle = document.getElementById('stat-obstacle').value;
            const speed = document.getElementById('stat-speed').value;
            const ice = document.getElementById('stat-ice').value;

            const code = `{
    idString: "${id}",
    name: "${name}",
    defType: DefinitionType.Melee,
    tier: Tier.${tier},
    ${fireMode === 'Auto' ? 'fireMode: FireMode.Auto,' : ''}
    damage: ${damage},
    speedMultiplier: ${speed},
    obstacleMultiplier: ${obstacle},
    iceMultiplier: ${ice},
    radius: ${radius},
    offset: Vec(3.1, 0.9),
    cooldown: ${cooldown},
    swingSound: "soft_swing",
    fists: {
        animationDuration: 100,
        left: Vec(38, -35),
        right: Vec(38, 35)
    },
    image: {
        position: Vec(62, 42),
        angle: 60,
        lootScale: 0.8
    },
    animation: [
        {
            duration: 100,
            fists: { left: Vec(38, -35), right: Vec(70, 20) },
            image: { position: Vec(90, 8), angle: 5 }
        },
        {
            duration: 100,
            fists: { left: Vec(38, -35), right: Vec(38, 35) },
            image: { position: Vec(62, 42), angle: 60 }
        }
    ]
},`;
            document.getElementById('code-output').textContent = code;
        }

        function updatePreview() { generateCode(); }

        function copyCode() {
            navigator.clipboard.writeText(document.getElementById('code-output').textContent);
            alert('âœ… ì½”ë“œ ë³µì‚¬ë¨!');
        }

        function downloadCode() {
            const code = document.getElementById('code-output').textContent;
            const id = document.getElementById('melee-id').value || 'my_melee';
            const blob = new Blob([code], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${id}_definition.ts`;
            a.click();
        }

        function exportMelee() {
            generateCode();
            showTab('export');
        }

        async function saveToFile() {
            const code = document.getElementById('code-output').textContent;
            const id = document.getElementById('melee-id').value;
            const name = document.getElementById('melee-name').value;
            if (!id || !name) { alert('âŒ IDì™€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!'); return; }

            const spawnLocations = [];
            if (document.getElementById('spawn-melee-crate').checked) spawnLocations.push('meleeCrate');
            if (document.getElementById('spawn-regular-crate').checked) spawnLocations.push('regularCrate');
            if (document.getElementById('spawn-airdrop-melee').checked) spawnLocations.push('airdropMelee');
            const spawnWeight = parseFloat(document.getElementById('spawn-weight').value);

            try {
                const response = await fetch('http://localhost:8080/api/melees/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, meleeId: id, spawnLocations, spawnWeight })
                });
                const result = await response.json();
                if (result.success) {
                    alert(`âœ… ê·¼ì ‘ë¬´ê¸° "${name}" ì¶”ê°€ ì™„ë£Œ!\n\në‹¤ìŒ ë‹¨ê³„:\n1. bun run build\n2. ì„œë²„ ì¬ì‹œì‘`);
                } else {
                    alert('âŒ ì˜¤ë¥˜: ' + result.error);
                }
            } catch (error) {
                alert('âŒ API ì„œë²„ ì—°ê²° ì‹¤íŒ¨!\n\në¨¼ì € API ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.');
            }
        }

        createGallery('melee-gallery');
        createGallery('full-gallery');
        generateCode();
    </script>
</body>

</html>