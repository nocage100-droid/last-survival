<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµœí›„ì˜ìƒì¡´ í½ ì—ë””í„°</title>
    <link rel="icon" type="image/svg+xml" href="../img/logos/suroi_favicon.svg">
    <link rel="stylesheet" href="admin.css">
    <style>
        .stat-sliders {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .slider-group {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 8px;
        }

        .slider-group label {
            display: flex;
            justify-content: space-between;
            color: #aaa;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .slider-group .value {
            color: #667eea;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tabs button {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #aaa;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
        }

        .tabs button.active {
            background: rgba(102, 126, 234, 0.3);
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .code-output {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 11px;
            max-height: 300px;
            overflow: auto;
            white-space: pre-wrap;
            color: #38ef7d;
        }

        .quality-positive {
            color: #38ef7d;
        }

        .quality-neutral {
            color: #fbbf24;
        }

        .quality-negative {
            color: #f5576c;
        }

        .perk-preview {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
        }

        .perk-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .effect-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .effect-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }

        .effect-item .effect-config {
            display: flex;
            gap: 10px;
            flex: 1;
        }

        .effect-item input[type="number"] {
            width: 80px;
            padding: 5px;
            border-radius: 4px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
        }
    </style>
</head>

<body>
    <header class="header">
        <h1><span
                style="background: linear-gradient(135deg, #ff6b00, #ff4500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900;">ìµœí›„ì˜ìƒì¡´</span>
            í½ ì—ë””í„°</h1>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="location.href='/admin/'">â† ê´€ë¦¬ì íŒ¨ë„</button>
            <button class="btn btn-success" onclick="exportPerk()">ğŸ’¾ ë‚´ë³´ë‚´ê¸°</button>
        </div>
    </header>

    <div style="padding: 20px;">
        <div class="tabs">
            <button class="active" onclick="showTab('create')">â­ í½ ìƒì„±</button>
            <button onclick="showTab('export')">ğŸ“„ ì½”ë“œ ì¶œë ¥</button>
        </div>

        <div id="create" class="tab-content active">
            <div class="card">
                <h2>ê¸°ë³¸ ì •ë³´</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>í½ ID (ì˜ë¬¸)</label>
                        <input type="text" id="perk-id" placeholder="my_perk" oninput="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>í½ ì´ë¦„</label>
                        <input type="text" id="perk-name" placeholder="My Perk" oninput="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>ì¹´í…Œê³ ë¦¬</label>
                        <select id="perk-category" onchange="updatePreview()">
                            <option value="Normal">Normal (ì¼ë°˜)</option>
                            <option value="Halloween">Halloween (í• ë¡œìœˆ)</option>
                            <option value="Hunted">Hunted (í—Œí‹°ë“œ)</option>
                            <option value="Infection">Infection (ê°ì—¼)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>í’ˆì§ˆ</label>
                        <select id="perk-quality" onchange="updatePreview()">
                            <option value="Positive">ê¸ì •ì  (Positive)</option>
                            <option value="Neutral">ì¤‘ë¦½ (Neutral)</option>
                            <option value="Negative">ë¶€ì •ì  (Negative)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>í½ ë¯¸ë¦¬ë³´ê¸°</h2>
                <div class="perk-preview">
                    <div class="perk-icon" id="perk-icon">â­</div>
                    <h3 id="preview-name" style="color:#667eea;">My Perk</h3>
                    <p id="preview-quality" class="quality-positive">ê¸ì •ì </p>
                </div>
            </div>

            <div class="card">
                <h2>íš¨ê³¼ ì„¤ì •</h2>
                <p style="color:#aaa; margin-bottom:15px;">í½ì´ ë¶€ì—¬í•˜ëŠ” íš¨ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>

                <div class="effect-item">
                    <input type="checkbox" id="eff-speed" onchange="updatePreview()">
                    <label>ğŸƒ ì´ë™ì†ë„ ë°°ìœ¨</label>
                    <input type="number" id="val-speed" value="1.2" step="0.1" min="0.5" max="2"
                        onchange="updatePreview()">
                </div>

                <div class="effect-item">
                    <input type="checkbox" id="eff-damage" onchange="updatePreview()">
                    <label>ğŸ’¥ í”¼í•´ëŸ‰ ë°°ìœ¨</label>
                    <input type="number" id="val-damage" value="1.2" step="0.1" min="0.5" max="3"
                        onchange="updatePreview()">
                </div>

                <div class="effect-item">
                    <input type="checkbox" id="eff-health" onchange="updatePreview()">
                    <label>â¤ï¸ ìµœëŒ€ ì²´ë ¥ ë°°ìœ¨</label>
                    <input type="number" id="val-health" value="1.5" step="0.1" min="0.5" max="3"
                        onchange="updatePreview()">
                </div>

                <div class="effect-item">
                    <input type="checkbox" id="eff-size" onchange="updatePreview()">
                    <label>ğŸ“ í¬ê¸° ë°°ìœ¨</label>
                    <input type="number" id="val-size" value="0.8" step="0.1" min="0.5" max="2"
                        onchange="updatePreview()">
                </div>

                <div class="effect-item">
                    <input type="checkbox" id="eff-reload" onchange="updatePreview()">
                    <label>ğŸ”„ ì¬ì¥ì „ ì†ë„ ë°°ìœ¨</label>
                    <input type="number" id="val-reload" value="0.7" step="0.1" min="0.3" max="2"
                        onchange="updatePreview()">
                </div>

                <div class="effect-item">
                    <input type="checkbox" id="eff-healing" onchange="updatePreview()">
                    <label>ğŸ’Š íë§ ë°°ìœ¨</label>
                    <input type="number" id="val-healing" value="1.5" step="0.1" min="0.5" max="3"
                        onchange="updatePreview()">
                </div>

                <div class="effect-item">
                    <input type="checkbox" id="eff-melee" onchange="updatePreview()">
                    <label>ğŸ—¡ï¸ ê·¼ì ‘ í”¼í•´ ë°°ìœ¨</label>
                    <input type="number" id="val-melee" value="1.3" step="0.1" min="0.5" max="3"
                        onchange="updatePreview()">
                </div>
            </div>

            <div class="card">
                <h2>ì¶”ê°€ ì˜µì…˜</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label><input type="checkbox" id="opt-noswap"> êµì²´ ë¶ˆê°€ (noSwap)</label>
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="opt-mechanical"> ê¸°ê³„ì  í½ (mechanical)</label>
                    </div>
                </div>
            </div>
        </div>

        <div id="export" class="tab-content">
            <div class="card">
                <h2>ğŸ“„ ìƒì„±ëœ TypeScript ì½”ë“œ</h2>
                <p style="color:#aaa; margin-bottom:15px;"><code>common/src/definitions/items/perks.ts</code>ì— ì¶”ê°€</p>
                <div class="code-output" id="code-output"></div>
                <div style="margin-top:15px; display:flex; gap:10px;">
                    <button class="btn btn-primary" onclick="copyCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
                    <button class="btn btn-success" onclick="downloadCode()">ğŸ’¾ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
                    <button class="btn btn-danger" onclick="saveToFile()"
                        style="background:linear-gradient(135deg,#f5576c 0%,#ff6b6b 100%);">ğŸš€ ê²Œì„ì— ì¶”ê°€</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const qualityIcons = { Positive: 'â­', Neutral: 'ğŸ”¶', Negative: 'ğŸ’€' };
        const qualityLabels = { Positive: 'ê¸ì •ì ', Neutral: 'ì¤‘ë¦½', Negative: 'ë¶€ì •ì ' };

        function showTab(tabId) {
            document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            if (tabId === 'export') generateCode();
        }

        function updatePreview() {
            const name = document.getElementById('perk-name').value || 'My Perk';
            const quality = document.getElementById('perk-quality').value;

            document.getElementById('preview-name').textContent = name;
            document.getElementById('perk-icon').textContent = qualityIcons[quality];
            document.getElementById('preview-quality').textContent = qualityLabels[quality];
            document.getElementById('preview-quality').className = 'quality-' + quality.toLowerCase();

            generateCode();
        }

        function generateCode() {
            const id = document.getElementById('perk-id').value || 'my_perk';
            const name = document.getElementById('perk-name').value || 'My Perk';
            const category = document.getElementById('perk-category').value;
            const quality = document.getElementById('perk-quality').value;
            const noSwap = document.getElementById('opt-noswap').checked;
            const mechanical = document.getElementById('opt-mechanical').checked;

            let effects = [];
            if (document.getElementById('eff-speed').checked) effects.push(`speedMod: ${document.getElementById('val-speed').value}`);
            if (document.getElementById('eff-damage').checked) effects.push(`damageMod: ${document.getElementById('val-damage').value}`);
            if (document.getElementById('eff-health').checked) effects.push(`healthMod: ${document.getElementById('val-health').value}`);
            if (document.getElementById('eff-size').checked) effects.push(`sizeMod: ${document.getElementById('val-size').value}`);
            if (document.getElementById('eff-reload').checked) effects.push(`reloadMod: ${document.getElementById('val-reload').value}`);
            if (document.getElementById('eff-healing').checked) effects.push(`healingMod: ${document.getElementById('val-healing').value}`);
            if (document.getElementById('eff-melee').checked) effects.push(`meleeDamageMod: ${document.getElementById('val-melee').value}`);

            const code = `{
    idString: "${id}",
    name: "${name}",
    defType: DefinitionType.Perk,
    category: PerkCategories.${category},
    quality: PerkQualities.${quality}${noSwap ? ',\n    noSwap: true' : ''}${mechanical ? ',\n    mechanical: true' : ''}${effects.length > 0 ? ',\n\n    ' + effects.join(',\n    ') : ''}
},`;

            document.getElementById('code-output').textContent = code;
        }

        function copyCode() {
            navigator.clipboard.writeText(document.getElementById('code-output').textContent);
            alert('âœ… ì½”ë“œ ë³µì‚¬ë¨!');
        }

        function downloadCode() {
            const code = document.getElementById('code-output').textContent;
            const id = document.getElementById('perk-id').value || 'my_perk';
            const blob = new Blob([code], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${id}_definition.ts`;
            a.click();
        }

        function exportPerk() {
            generateCode();
            showTab('export');
        }

        async function saveToFile() {
            const code = document.getElementById('code-output').textContent;
            const id = document.getElementById('perk-id').value;
            const name = document.getElementById('perk-name').value;
            if (!id || !name) { alert('âŒ IDì™€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!'); return; }

            try {
                const response = await fetch('http://localhost:8080/api/perks/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code, perkId: id })
                });
                const result = await response.json();
                if (result.success) {
                    alert(`âœ… í½ "${name}" ì¶”ê°€ ì™„ë£Œ!\n\në‹¤ìŒ ë‹¨ê³„:\n1. bun run build\n2. ì„œë²„ ì¬ì‹œì‘`);
                } else {
                    alert('âŒ ì˜¤ë¥˜: ' + result.error);
                }
            } catch (error) {
                alert('âŒ API ì„œë²„ ì—°ê²° ì‹¤íŒ¨!\n\në¨¼ì € API ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.');
            }
        }

        generateCode();
    </script>
</body>

</html>