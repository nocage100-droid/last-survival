<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìµœí›„ì˜ìƒì¡´ ë¬´ê¸° ì—ë””í„°</title>
    <link rel="icon" type="image/svg+xml" href="../img/logos/suroi_favicon.svg">
    <link rel="stylesheet" href="admin.css">
    <style>
        .weapon-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .weapon-item {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .weapon-item:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .weapon-item.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.3);
        }

        .weapon-item img {
            width: 100%;
            height: 60px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
        }

        .weapon-item .name {
            font-size: 11px;
            color: #aaa;
            margin-top: 5px;
            word-break: break-all;
        }

        .preview-area {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .preview-box {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .preview-box img {
            max-width: 200px;
            max-height: 100px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
        }

        .preview-box h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .stat-sliders {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .slider-group {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 8px;
        }

        .slider-group label {
            display: flex;
            justify-content: space-between;
            color: #aaa;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .slider-group input[type="range"] {
            width: 100%;
        }

        .slider-group .value {
            color: #667eea;
            font-weight: bold;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tabs button {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #aaa;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
        }

        .tabs button.active {
            background: rgba(102, 126, 234, 0.3);
            color: #fff;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .code-output {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow: auto;
            white-space: pre-wrap;
            color: #38ef7d;
        }

        .spawn-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            cursor: pointer;
            color: #aaa;
        }

        .spawn-checkbox:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .spawn-checkbox input:checked+* {
            color: #fff;
        }
    </style>
</head>

<body>
    <header class="header">
        <h1><span
                style="background: linear-gradient(135deg, #ff6b00, #ff4500); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900;">ìµœí›„ì˜ìƒì¡´</span>
            ë¬´ê¸° ì—ë””í„°</h1>
        <div class="header-actions">
            <button class="btn btn-primary" onclick="location.href='/admin/'">â† ê´€ë¦¬ì íŒ¨ë„</button>
            <button class="btn btn-success" onclick="exportWeapon()">ğŸ’¾ ë‚´ë³´ë‚´ê¸°</button>
        </div>
    </header>

    <div style="padding: 20px;">
        <div class="tabs">
            <button class="active" onclick="showTab('create')">ğŸ”« ë¬´ê¸° ìƒì„±</button>
            <button onclick="showTab('gallery')">ğŸ–¼ï¸ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬</button>
            <button onclick="showTab('export')">ğŸ“„ ì½”ë“œ ì¶œë ¥</button>
        </div>

        <!-- ë¬´ê¸° ìƒì„± íƒ­ -->
        <div id="create" class="tab-content active">
            <div class="card">
                <h2>ë¬´ê¸° ê¸°ë³¸ ì •ë³´</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>ë¬´ê¸° ID (ì˜ë¬¸)</label>
                        <input type="text" id="weapon-id" placeholder="my_gun" oninput="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>ë¬´ê¸° ì´ë¦„</label>
                        <input type="text" id="weapon-name" placeholder="My Gun" oninput="updatePreview()">
                    </div>
                    <div class="form-group">
                        <label>íƒ„ì•½ ì¢…ë¥˜</label>
                        <select id="weapon-ammo" onchange="updatePreview()">
                            <option value="9mm">9mm</option>
                            <option value="762mm">7.62mm</option>
                            <option value="556mm">5.56mm</option>
                            <option value="545mm">5.45mm</option>
                            <option value="50cal">.50 Cal</option>
                            <option value="12gauge">12 Gauge</option>
                            <option value="338lap">.338 Lapua</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>í‹°ì–´</label>
                        <select id="weapon-tier" onchange="updatePreview()">
                            <option value="D">D (ì¼ë°˜)</option>
                            <option value="C">C (ë¹„ì¼ë°˜)</option>
                            <option value="B">B (í¬ê·€)</option>
                            <option value="A">A (ì—í”½)</option>
                            <option value="S">S (ë ˆì „ë“œë¦¬)</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>ë°œì‚¬ ëª¨ë“œ</label>
                    <select id="weapon-firemode" onchange="updatePreview()">
                        <option value="Single">ë‹¨ë°œ</option>
                        <option value="Auto">ìë™</option>
                        <option value="Burst">ì ì‚¬</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h2>ì´ë¯¸ì§€ ì„ íƒ (ê¸°ì¡´ ë¬´ê¸° ìŠ¤í”„ë¼ì´íŠ¸ ì‚¬ìš©)</h2>
                <div class="preview-area">
                    <div class="preview-box">
                        <h4>ì„ íƒëœ ì´ë¯¸ì§€</h4>
                        <img id="selected-preview" src="../img/game/shared/weapons/ak47.svg" alt="Preview">
                        <p id="selected-name" style="color:#aaa; font-size:12px; margin-top:10px;">ak47.svg</p>
                    </div>
                </div>
                <div class="weapon-gallery" id="weapon-gallery"></div>
            </div>

            <div class="card">
                <h2>ë¬´ê¸° ìŠ¤íƒ¯ ì¡°ì •</h2>
                <div class="stat-sliders">
                    <div class="slider-group">
                        <label>í”¼í•´ëŸ‰ <span class="value" id="val-damage">15</span></label>
                        <input type="range" id="stat-damage" min="1" max="100" value="15"
                            oninput="updateStat('damage')">
                    </div>
                    <div class="slider-group">
                        <label>ë°œì‚¬ì†ë„ (RPM) <span class="value" id="val-rpm">600</span></label>
                        <input type="range" id="stat-rpm" min="60" max="1200" value="600" step="10"
                            oninput="updateStat('rpm')">
                    </div>
                    <div class="slider-group">
                        <label>íƒ„ì°½ ìš©ëŸ‰ <span class="value" id="val-capacity">30</span></label>
                        <input type="range" id="stat-capacity" min="1" max="200" value="30"
                            oninput="updateStat('capacity')">
                    </div>
                    <div class="slider-group">
                        <label>ì¬ì¥ì „ ì‹œê°„ (ì´ˆ) <span class="value" id="val-reload">2.0</span></label>
                        <input type="range" id="stat-reload" min="0.5" max="5" value="2" step="0.1"
                            oninput="updateStat('reload')">
                    </div>
                    <div class="slider-group">
                        <label>ì‚¬ê±°ë¦¬ <span class="value" id="val-range">150</span></label>
                        <input type="range" id="stat-range" min="20" max="300" value="150"
                            oninput="updateStat('range')">
                    </div>
                    <div class="slider-group">
                        <label>íƒ„í¼ì§ (ë„) <span class="value" id="val-spread">5</span></label>
                        <input type="range" id="stat-spread" min="0" max="30" value="5" oninput="updateStat('spread')">
                    </div>
                    <div class="slider-group">
                        <label>ì´ë™ì†ë„ ë°°ìœ¨ <span class="value" id="val-speed">1.0</span></label>
                        <input type="range" id="stat-speed" min="0.5" max="1.2" value="1" step="0.01"
                            oninput="updateStat('speed')">
                    </div>
                    <div class="slider-group">
                        <label>ì¥ì• ë¬¼ í”¼í•´ ë°°ìœ¨ <span class="value" id="val-obstacle">1.0</span></label>
                        <input type="range" id="stat-obstacle" min="0.5" max="3" value="1" step="0.1"
                            oninput="updateStat('obstacle')">
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“ ìŠ¤í° ìœ„ì¹˜ ì„¤ì •</h2>
                <p style="color:#aaa; margin-bottom:15px;">ë¬´ê¸°ê°€ ë‚˜íƒ€ë‚  ìœ„ì¹˜ì™€ í™•ë¥ ì„ ì„¤ì •í•˜ì„¸ìš”.</p>
                <div class="spawn-options"
                    style="display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:10px;">
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-ground" checked> ğŸŒ¿ ë°”ë‹¥ (Ground
                        Loot)</label>
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-crate" checked> ğŸ“¦ ì¼ë°˜ ìƒì</label>
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-aegis"> ğŸ›¡ï¸ AEGIS ìƒì</label>
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-flint"> ğŸ”¥ Flint ìƒì</label>
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-airdrop"> ğŸª‚ ì—ì–´ë“œë</label>
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-gold-airdrop"> âœ¨ í™©ê¸ˆ ì—ì–´ë“œë</label>
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-gun-locker"> ğŸ” ì´ê¸° ë³´ê´€í•¨</label>
                    <label class="spawn-checkbox"><input type="checkbox" id="spawn-briefcase"> ğŸ’¼ ì„œë¥˜ê°€ë°©</label>
                </div>
                <div class="form-row" style="margin-top:15px;">
                    <div class="form-group">
                        <label>ìŠ¤í° í™•ë¥  (weight)</label>
                        <input type="number" id="spawn-weight" value="0.5" step="0.01" min="0.001" max="10">
                        <small style="color:#888;">ë†’ì„ìˆ˜ë¡ ìì£¼ ë“±ì¥ (ì¼ë°˜ì´ 1~2, í¬ê·€ì´ 0.01~0.1)</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê°¤ëŸ¬ë¦¬ íƒ­ -->
        <div id="gallery" class="tab-content">
            <div class="card">
                <h2>ğŸ–¼ï¸ ì‚¬ìš© ê°€ëŠ¥í•œ ë¬´ê¸° ì´ë¯¸ì§€ (182ê°œ)</h2>
                <input type="text" id="gallery-search" placeholder="ğŸ” ì´ë¯¸ì§€ ê²€ìƒ‰..." oninput="filterGallery()"
                    style="margin-bottom:15px; width:100%; padding:10px; border-radius:6px; border:1px solid rgba(255,255,255,0.2); background:rgba(0,0,0,0.2); color:#fff;">
                <div class="weapon-gallery" id="full-gallery" style="max-height:600px;"></div>
            </div>
        </div>

        <!-- ì½”ë“œ ì¶œë ¥ íƒ­ -->
        <div id="export" class="tab-content">
            <div class="card">
                <h2>ğŸ“„ ìƒì„±ëœ TypeScript ì½”ë“œ</h2>
                <p style="color:#aaa; margin-bottom:15px;">ì´ ì½”ë“œë¥¼ <code>common/src/definitions/items/guns.ts</code>ì—
                    ì¶”ê°€í•˜ì„¸ìš”.</p>
                <div class="code-output" id="code-output"></div>
                <div style="margin-top:15px; display:flex; gap:10px;">
                    <button class="btn btn-primary" onclick="copyCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬</button>
                    <button class="btn btn-success" onclick="downloadCode()">ğŸ’¾ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</button>
                    <button class="btn btn-danger" onclick="saveToFile()"
                        style="background:linear-gradient(135deg,#f5576c 0%,#ff6b6b 100%);">ğŸš€ ê²Œì„ì— ì¶”ê°€</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë¬´ê¸° ì´ë¯¸ì§€ ëª©ë¡
        const weaponImages = [
            "acr", "ak47", "aks74u", "an94", "arx160", "aug", "badlander", "blr", "cz600", "cz75a",
            "deagle", "dp12", "flues", "g19", "hp18", "l115a1", "lewis_gun", "m1_garand", "m16a4",
            "m1895", "m249", "m37", "m3k", "m590m", "maul", "mcx_spear", "mg36", "mini14", "mk18",
            "model89", "mosin", "mp153", "mp40", "mp5k", "negev", "ots23", "pk61", "pp19", "psm",
            "revitalizer", "rpk16", "rpk74", "rsh12", "saf200", "seedshot", "shak12", "sks", "sr25",
            "stoner63", "svua", "tango51", "ulr338", "usas12", "vector", "vks", "vss", "yesaul"
        ];

        let selectedImage = "ak47";

        // ê°¤ëŸ¬ë¦¬ ìƒì„±
        function createGallery(containerId, selectable = true) {
            const container = document.getElementById(containerId);
            container.innerHTML = weaponImages.map(name => `
            <div class="weapon-item ${name === selectedImage ? 'selected' : ''}" onclick="${selectable ? `selectWeapon('${name}')` : ''}">
                <img src="../img/game/shared/weapons/${name}.svg" alt="${name}" onerror="this.src='../img/game/shared/weapons/ak47.svg'">
                <div class="name">${name}</div>
            </div>
        `).join('');
        }

        function selectWeapon(name) {
            selectedImage = name;
            document.querySelectorAll('.weapon-item').forEach(el => el.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            document.getElementById('selected-preview').src = `../img/game/shared/weapons/${name}.svg`;
            document.getElementById('selected-name').textContent = name + '.svg';
            updatePreview();
        }

        function updateStat(stat) {
            const el = document.getElementById(`stat-${stat === 'rpm' ? 'rpm' : stat}`);
            const valEl = document.getElementById(`val-${stat}`);
            valEl.textContent = el.value;
            updatePreview();
        }

        function showTab(tabId) {
            document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            if (tabId === 'export') generateCode();
        }

        function filterGallery() {
            const search = document.getElementById('gallery-search').value.toLowerCase();
            document.querySelectorAll('#full-gallery .weapon-item').forEach(item => {
                const name = item.querySelector('.name').textContent.toLowerCase();
                item.style.display = name.includes(search) ? 'block' : 'none';
            });
        }

        function generateCode() {
            const id = document.getElementById('weapon-id').value || 'my_gun';
            const name = document.getElementById('weapon-name').value || 'My Gun';
            const ammo = document.getElementById('weapon-ammo').value;
            const tier = document.getElementById('weapon-tier').value;
            const fireMode = document.getElementById('weapon-firemode').value;
            const damage = document.getElementById('stat-damage').value;
            const rpm = document.getElementById('stat-rpm').value;
            const fireDelay = Math.round(60000 / rpm);
            const capacity = document.getElementById('stat-capacity').value;
            const reload = document.getElementById('stat-reload').value;
            const range = document.getElementById('stat-range').value;
            const spread = document.getElementById('stat-spread').value;
            const speed = document.getElementById('stat-speed').value;
            const obstacle = document.getElementById('stat-obstacle').value;

            const code = `{
    idString: "${id}",
    name: "${name}",
    defType: DefinitionType.Gun,
    tier: Tier.${tier},
    ammoType: "${ammo}",
    ammoSpawnAmount: ${capacity * 2},
    fireDelay: ${fireDelay},
    switchDelay: 250,
    speedMultiplier: ${speed},
    recoilMultiplier: 0.8,
    recoilDuration: 100,
    fireMode: FireMode.${fireMode},
    shotSpread: ${spread},
    moveSpread: ${parseInt(spread) + 3},
    length: 6,
    fists: {
        left: Vec(40, 0),
        right: Vec(40, 0),
        animationDuration: 100
    },
    image: { position: Vec(70, 0) },
    casingParticles: [{ position: Vec(3.5, 0.5) }],
    capacity: ${capacity},
    reloadTime: ${reload},
    ballistics: {
        damage: ${damage},
        obstacleMultiplier: ${obstacle},
        speed: 0.25,
        range: ${range}
    }
},`;

            document.getElementById('code-output').textContent = code;
        }

        function updatePreview() { generateCode(); }

        function copyCode() {
            navigator.clipboard.writeText(document.getElementById('code-output').textContent);
            alert('âœ… ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function downloadCode() {
            const code = document.getElementById('code-output').textContent;
            const id = document.getElementById('weapon-id').value || 'my_gun';
            const blob = new Blob([code], { type: 'text/plain' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = `${id}_definition.ts`;
            a.click();
        }

        function exportWeapon() {
            generateCode();
            showTab('export');
            document.querySelector('.tabs button:last-child').classList.add('active');
        }

        // ğŸ”¥ ì‹¤ì œ íŒŒì¼ì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        async function saveToFile() {
            const code = document.getElementById('code-output').textContent;
            const id = document.getElementById('weapon-id').value;
            const name = document.getElementById('weapon-name').value;

            if (!id || !name) {
                alert('âŒ ë¬´ê¸° IDì™€ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }

            // ìŠ¤í° ìœ„ì¹˜ ìˆ˜ì§‘
            const spawnLocations = [];
            if (document.getElementById('spawn-ground').checked) spawnLocations.push('ground');
            if (document.getElementById('spawn-crate').checked) spawnLocations.push('crate');
            if (document.getElementById('spawn-aegis').checked) spawnLocations.push('aegis');
            if (document.getElementById('spawn-flint').checked) spawnLocations.push('flint');
            if (document.getElementById('spawn-airdrop').checked) spawnLocations.push('airdrop');
            if (document.getElementById('spawn-gold-airdrop').checked) spawnLocations.push('goldAirdrop');
            if (document.getElementById('spawn-gun-locker').checked) spawnLocations.push('gunLocker');
            if (document.getElementById('spawn-briefcase').checked) spawnLocations.push('briefcase');

            const spawnWeight = parseFloat(document.getElementById('spawn-weight').value);

            try {
                const response = await fetch('http://localhost:8080/api/guns/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        code,
                        weaponId: id,
                        spawnLocations,
                        spawnWeight
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert(`âœ… ë¬´ê¸° "${name}" ì¶”ê°€ ì™„ë£Œ!\n\nğŸ“ ìŠ¤í° ìœ„ì¹˜: ${spawnLocations.join(', ')}\nâš–ï¸ ìŠ¤í° í™•ë¥ : ${spawnWeight}\n\në‹¤ìŒ ë‹¨ê³„:\n1. í„°ë¯¸ë„ì—ì„œ: bun run build\n2. ì„œë²„ ì¬ì‹œì‘: bun dev`);
                } else {
                    alert('âŒ ì˜¤ë¥˜: ' + result.error);
                }
            } catch (error) {
                alert('âŒ API ì„œë²„ ì—°ê²° ì‹¤íŒ¨!\n\në¨¼ì € API ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”:\ncd suroi/server\nbun run admin-api.ts');
            }
        }

        // ì´ˆê¸°í™”
        createGallery('weapon-gallery');
        createGallery('full-gallery', false);
        generateCode();
    </script>
</body>

</html>